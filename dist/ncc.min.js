/*! @noccela/ncc-cloud-integration 1.0.0, built Mon Mar 02 2020 19:24:13 GMT+0200 (Eastern European Standard Time) */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("ws")):"function"==typeof define&&define.amd?define(["ws"],e):"object"==typeof exports?exports.NccIntegration=e(require("ws")):t.NccIntegration=e(t.ws)}(this,(function(t){return function(t){function e(e){for(var r,o,i=e[0],a=e[1],s=0,c=[];s<i.length;s++)o=i[s],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&c.push(n[o][0]),n[o]=0;for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(t[r]=a[r]);for(u&&u(e);c.length;)c.shift()()}var r={},n={0:0};function o(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=r,o.d=function(t,e,r){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(r,n,function(e){return t[e]}.bind(null,n));return r},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o.oe=function(t){throw console.error(t),t};var i=this.webpackJsonpNccIntegration=this.webpackJsonpNccIntegration||[],a=i.push.bind(i);i.push=e,i=i.slice();for(var s=0;s<i.length;s++)e(i[s]);var u=a;return o(o.s=13)}([function(t,e,r){"use strict";var n,o=function(t){return"NCCWS: ".concat(t)},i={log:function(t){return console.log(o(t))},warn:function(t){return console.warn(o(t))},error:function(t){return console.error(o(t))},exception:(n=null,n=console.exception?console.exception:console.error,function(t,e){return n(o(t),e)}),debug:function(t){for(var e,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return(e=console).debug.apply(e,[o(t)].concat(n))}};r.d(e,"e",(function(){return a})),r.d(e,"b",(function(){return s})),r.d(e,"a",(function(){return u})),r.d(e,"c",(function(){return c})),r.d(e,"d",(function(){return f}));var a={PING_MSG:"",PONG_MSG:"1",CLOUD_RESPONSE_OK:"ok"},s={LOCATION_UPDATE:"LOCATION_UPDATE",TAG_STATE:"TAG_STATE",TAG_DIFF:"TAG_DIFF"},u={loggers:[i],reopenBrokenConnection:!0,retryIntervalMin:1e3,retryIntervalMax:6e4,retryIntervalIncrease:1e3,logRawMessages:!0,onMessage:null,onClose:null,onError:null,processMessages:!0,requestTimeout:6e4,automaticTokenRenewal:!0,tokenRefreshFailureRetryTimeout:6e4,useWebWorkers:!0,registrationAttemptsUntilIgnored:50,waitForFailedReRegistration:1e3},c="Cannot send message, no authenticated connection available",f=6},function(t,e,r){"use strict";r.d(e,"a",(function(){return u})),r.d(e,"c",(function(){return c})),r.d(e,"d",(function(){return f})),r.d(e,"b",(function(){return l})),r.d(e,"e",(function(){return h}));var n=r(0);function o(t,e,r,n,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,o)}function i(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function s(t){o(a,n,i,s,u,"next",t)}function u(t){o(a,n,i,s,u,"throw",t)}s(void 0)}))}}function a(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}function s(t){return"x".repeat(t).replace(/[x]/g,(function(){return(16*Math.random()|0).toString(16)}))}function u(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.d;return t?a():s(e)}function c(t,e){if(!t||!Number.isInteger(t))throw Error("Invalid accountId ".concat(t));if(!e||!Number.isInteger(e))throw Error("Invalid siteId ".concat(e))}function f(t,e,r){var n=new Set(e),o=Object.getOwnPropertyNames(t),i=!0,a=!1,s=void 0;try{for(var u,c=o[Symbol.iterator]();!(i=(u=c.next()).done);i=!0){var f=u.value;if(!n.has(f))throw Error("Invalid option ".concat(f))}}catch(t){a=!0,s=t}finally{try{i||null==c.return||c.return()}finally{if(a)throw s}}if(r){var l=!0,h=!1,p=void 0;try{for(var d,y=r[Symbol.iterator]();!(l=(d=y.next()).done);l=!0){var g=d.value;if(!Object.prototype.hasOwnProperty.call(t,g))throw Error("Missing required option ".concat(g))}}catch(t){h=!0,p=t}finally{try{l||null==y.return||y.return()}finally{if(h)throw p}}}}function l(){return"undefined"==typeof window}function h(t){return p.apply(this,arguments)}function p(){return(p=i(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t){setTimeout(t,e)}));case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}},function(t,e,r){"use strict";(function(t){r.d(e,"a",(function(){return a})),r.d(e,"b",(function(){return s}));var n=r(1);function o(t,e,r,n,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,o)}function i(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function s(t){o(a,n,i,s,u,"next",t)}function u(t){o(a,n,i,s,u,"throw",t)}s(void 0)}))}}function a(){return Object(n.b)()?function(e){return t.from(e,"base64").toString("binary")}:atob}function s(){return u.apply(this,arguments)}function u(){return(u=i(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(n.b)()?Promise.resolve().then(r.t.bind(null,12,7)).then((function(t){return t.default})):Promise.resolve(WebSocket);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}}).call(this,r(6).Buffer)},function(t,e){var r=function(t){function e(){this.fetch=!1,this.DOMException=t.DOMException}return e.prototype=t,new e}("undefined"!=typeof self?self:this);!function(t){!function(e){var r="URLSearchParams"in t,n="Symbol"in t&&"iterator"in Symbol,o="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),i="FormData"in t,a="ArrayBuffer"in t;if(a)var s=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],u=ArrayBuffer.isView||function(t){return t&&s.indexOf(Object.prototype.toString.call(t))>-1};function c(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function f(t){return"string"!=typeof t&&(t=String(t)),t}function l(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return n&&(e[Symbol.iterator]=function(){return e}),e}function h(t){this.map={},t instanceof h?t.forEach((function(t,e){this.append(e,t)}),this):Array.isArray(t)?t.forEach((function(t){this.append(t[0],t[1])}),this):t&&Object.getOwnPropertyNames(t).forEach((function(e){this.append(e,t[e])}),this)}function p(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function d(t){return new Promise((function(e,r){t.onload=function(){e(t.result)},t.onerror=function(){r(t.error)}}))}function y(t){var e=new FileReader,r=d(e);return e.readAsArrayBuffer(t),r}function g(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function v(){return this.bodyUsed=!1,this._initBody=function(t){var e;this._bodyInit=t,t?"string"==typeof t?this._bodyText=t:o&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:i&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:r&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():a&&o&&((e=t)&&DataView.prototype.isPrototypeOf(e))?(this._bodyArrayBuffer=g(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):a&&(ArrayBuffer.prototype.isPrototypeOf(t)||u(t))?this._bodyArrayBuffer=g(t):this._bodyText=t=Object.prototype.toString.call(t):this._bodyText="",this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},o&&(this.blob=function(){var t=p(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?p(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(y)}),this.text=function(){var t,e,r,n=p(this);if(n)return n;if(this._bodyBlob)return t=this._bodyBlob,e=new FileReader,r=d(e),e.readAsText(t),r;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),r=new Array(e.length),n=0;n<e.length;n++)r[n]=String.fromCharCode(e[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(m)}),this.json=function(){return this.text().then(JSON.parse)},this}h.prototype.append=function(t,e){t=c(t),e=f(e);var r=this.map[t];this.map[t]=r?r+", "+e:e},h.prototype.delete=function(t){delete this.map[c(t)]},h.prototype.get=function(t){return t=c(t),this.has(t)?this.map[t]:null},h.prototype.has=function(t){return this.map.hasOwnProperty(c(t))},h.prototype.set=function(t,e){this.map[c(t)]=f(e)},h.prototype.forEach=function(t,e){for(var r in this.map)this.map.hasOwnProperty(r)&&t.call(e,this.map[r],r,this)},h.prototype.keys=function(){var t=[];return this.forEach((function(e,r){t.push(r)})),l(t)},h.prototype.values=function(){var t=[];return this.forEach((function(e){t.push(e)})),l(t)},h.prototype.entries=function(){var t=[];return this.forEach((function(e,r){t.push([r,e])})),l(t)},n&&(h.prototype[Symbol.iterator]=h.prototype.entries);var b=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function w(t,e){var r,n,o=(e=e||{}).body;if(t instanceof w){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new h(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,o||null==t._bodyInit||(o=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",!e.headers&&this.headers||(this.headers=new h(e.headers)),this.method=(r=e.method||this.method||"GET",n=r.toUpperCase(),b.indexOf(n)>-1?n:r),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(o)}function m(t){var e=new FormData;return t.trim().split("&").forEach((function(t){if(t){var r=t.split("="),n=r.shift().replace(/\+/g," "),o=r.join("=").replace(/\+/g," ");e.append(decodeURIComponent(n),decodeURIComponent(o))}})),e}function _(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new h(e.headers),this.url=e.url||"",this._initBody(t)}w.prototype.clone=function(){return new w(this,{body:this._bodyInit})},v.call(w.prototype),v.call(_.prototype),_.prototype.clone=function(){return new _(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new h(this.headers),url:this.url})},_.error=function(){var t=new _(null,{status:0,statusText:""});return t.type="error",t};var k=[301,302,303,307,308];_.redirect=function(t,e){if(-1===k.indexOf(e))throw new RangeError("Invalid status code");return new _(null,{status:e,headers:{location:t}})},e.DOMException=t.DOMException;try{new e.DOMException}catch(t){e.DOMException=function(t,e){this.message=t,this.name=e;var r=Error(t);this.stack=r.stack},e.DOMException.prototype=Object.create(Error.prototype),e.DOMException.prototype.constructor=e.DOMException}function E(t,r){return new Promise((function(n,i){var a=new w(t,r);if(a.signal&&a.signal.aborted)return i(new e.DOMException("Aborted","AbortError"));var s=new XMLHttpRequest;function u(){s.abort()}s.onload=function(){var t,e,r={status:s.status,statusText:s.statusText,headers:(t=s.getAllResponseHeaders()||"",e=new h,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(t){var r=t.split(":"),n=r.shift().trim();if(n){var o=r.join(":").trim();e.append(n,o)}})),e)};r.url="responseURL"in s?s.responseURL:r.headers.get("X-Request-URL");var o="response"in s?s.response:s.responseText;n(new _(o,r))},s.onerror=function(){i(new TypeError("Network request failed"))},s.ontimeout=function(){i(new TypeError("Network request failed"))},s.onabort=function(){i(new e.DOMException("Aborted","AbortError"))},s.open(a.method,a.url,!0),"include"===a.credentials?s.withCredentials=!0:"omit"===a.credentials&&(s.withCredentials=!1),"responseType"in s&&o&&(s.responseType="blob"),a.headers.forEach((function(t,e){s.setRequestHeader(e,t)})),a.signal&&(a.signal.addEventListener("abort",u),s.onreadystatechange=function(){4===s.readyState&&a.signal.removeEventListener("abort",u)}),s.send(void 0===a._bodyInit?null:a._bodyInit)}))}E.polyfill=!0,t.fetch||(t.fetch=E,t.Headers=h,t.Request=w,t.Response=_),e.Headers=h,e.Request=w,e.Response=_,e.fetch=E}({})}(r),delete r.fetch.polyfill,(e=r.fetch).default=r.fetch,e.fetch=r.fetch,e.Headers=r.Headers,e.Request=r.Request,e.Response=r.Response,t.exports=e},function(t,e,r){(function(t){!function(){"use strict";function e(t){const e=4294967296;let r,n,o=new Uint8Array(128),i=0;return a(t),o.subarray(0,i);function a(t){switch(typeof t){case"undefined":s(t);break;case"boolean":!function(t){c(t?195:194)}(t);break;case"number":!function(t){if(isFinite(t)&&Math.floor(t)===t)if(t>=0&&t<=127)c(t);else if(t<0&&t>=-32)c(t);else if(t>0&&t<=255)f([204,t]);else if(t>=-128&&t<=127)f([208,t]);else if(t>0&&t<=65535)f([205,t>>>8,t]);else if(t>=-32768&&t<=32767)f([209,t>>>8,t]);else if(t>0&&t<=4294967295)f([206,t>>>24,t>>>16,t>>>8,t]);else if(t>=-2147483648&&t<=2147483647)f([210,t>>>24,t>>>16,t>>>8,t]);else if(t>0&&t<=0x10000000000000000){let r=t/e,n=t%e;f([211,r>>>24,r>>>16,r>>>8,r,n>>>24,n>>>16,n>>>8,n])}else t>=-0x8000000000000000&&t<=0x8000000000000000?(c(211),l(t)):f(t<0?[211,128,0,0,0,0,0,0,0]:[207,255,255,255,255,255,255,255,255]);else n||(r=new ArrayBuffer(8),n=new DataView(r)),n.setFloat64(0,t),c(203),f(new Uint8Array(r))}(t);break;case"string":!function(t){let e=function(t){let e=!0,r=t.length;for(let n=0;n<r;n++)if(t.charCodeAt(n)>127){e=!1;break}let n=0,o=new Uint8Array(t.length*(e?1:4));for(let e=0;e!==r;e++){let i=t.charCodeAt(e);if(i<128)o[n++]=i;else{if(i<2048)o[n++]=i>>6|192;else{if(i>55295&&i<56320){if(++e>=r)throw new Error("UTF-8 encode: incomplete surrogate pair");let a=t.charCodeAt(e);if(a<56320||a>57343)throw new Error("UTF-8 encode: second surrogate character 0x"+a.toString(16)+" at index "+e+" out of range");i=65536+((1023&i)<<10)+(1023&a),o[n++]=i>>18|240,o[n++]=i>>12&63|128}else o[n++]=i>>12|224;o[n++]=i>>6&63|128}o[n++]=63&i|128}}return e?o:o.subarray(0,n)}(t),r=e.length;r<=31?c(160+r):f(r<=255?[217,r]:r<=65535?[218,r>>>8,r]:[219,r>>>24,r>>>16,r>>>8,r]);f(e)}(t);break;case"object":null===t?s(t):t instanceof Date?function(t){let r=t.getTime()/1e3;if(0===t.getMilliseconds()&&r>=0&&r<4294967296)f([214,255,r>>>24,r>>>16,r>>>8,r]);else if(r>=0&&r<17179869184){let n=1e6*t.getMilliseconds();f([215,255,n>>>22,n>>>14,n>>>6,n<<2>>>0|r/e,r>>>24,r>>>16,r>>>8,r])}else{let e=1e6*t.getMilliseconds();f([199,12,255,e>>>24,e>>>16,e>>>8,e]),l(r)}}(t):Array.isArray(t)?u(t):t instanceof Uint8Array||t instanceof Uint8ClampedArray?function(t){let e=t.length;f(e<=15?[196,e]:e<=65535?[197,e>>>8,e]:[198,e>>>24,e>>>16,e>>>8,e]);f(t)}(t):t instanceof Int8Array||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array?u(t):function(t){let e=0;for(let r in t)e++;e<=15?c(128+e):f(e<=65535?[222,e>>>8,e]:[223,e>>>24,e>>>16,e>>>8,e]);for(let e in t)a(e),a(t[e])}(t)}}function s(t){c(192)}function u(t){let e=t.length;e<=15?c(144+e):f(e<=65535?[220,e>>>8,e]:[221,e>>>24,e>>>16,e>>>8,e]);for(let r=0;r<e;r++)a(t[r])}function c(t){if(o.length<i+1){let t=2*o.length;for(;t<i+1;)t*=2;let e=new Uint8Array(t);e.set(o),o=e}o[i]=t,i++}function f(t){if(o.length<i+t.length){let e=2*o.length;for(;e<i+t.length;)e*=2;let r=new Uint8Array(e);r.set(o),o=r}o.set(t,i),i+=t.length}function l(t){let r,n;t>=0?(r=t/e,n=t%e):(t++,r=Math.abs(t)/e,n=Math.abs(t)%e,r=~r,n=~n),f([r>>>24,r>>>16,r>>>8,r,n>>>24,n>>>16,n>>>8,n])}}function r(t){let e=0;if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),"object"!=typeof t||void 0===t.length)throw new Error("Invalid argument type: Expected a byte array (Array or Uint8Array) to deserialize.");if(!t.length)throw new Error("Invalid argument: The byte array to deserialize is empty.");t instanceof Uint8Array||(t=new Uint8Array(t));let r=n();return t.length,r;function n(){const r=t[e++];if(r>=0&&r<=127)return r;if(r>=128&&r<=143)return u(r-128);if(r>=144&&r<=159)return c(r-144);if(r>=160&&r<=191)return f(r-160);if(192===r)return null;if(193===r)throw new Error("Invalid byte code 0xc1 found.");if(194===r)return!1;if(195===r)return!0;if(196===r)return s(-1,1);if(197===r)return s(-1,2);if(198===r)return s(-1,4);if(199===r)return l(-1,1);if(200===r)return l(-1,2);if(201===r)return l(-1,4);if(202===r)return a(4);if(203===r)return a(8);if(204===r)return i(1);if(205===r)return i(2);if(206===r)return i(4);if(207===r)return i(8);if(208===r)return o(1);if(209===r)return o(2);if(210===r)return o(4);if(211===r)return o(8);if(212===r)return l(1);if(213===r)return l(2);if(214===r)return l(4);if(215===r)return l(8);if(216===r)return l(16);if(217===r)return f(-1,1);if(218===r)return f(-1,2);if(219===r)return f(-1,4);if(220===r)return c(-1,2);if(221===r)return c(-1,4);if(222===r)return u(-1,2);if(223===r)return u(-1,4);if(r>=224&&r<=255)return r-256;throw console.debug("msgpack array:",t),new Error("Invalid byte value '"+r+"' at index "+(e-1)+" in the MessagePack binary data (length "+t.length+"): Expecting a range of 0 to 255. This is not a byte array.")}function o(r){let n=0,o=!0;for(;r-- >0;)if(o){let r=t[e++];n+=127&r,128&r&&(n-=128),o=!1}else n*=256,n+=t[e++];return n}function i(r){let n=0;for(;r-- >0;)n*=256,n+=t[e++];return n}function a(r){let n=new DataView(t.buffer,e,r);return e+=r,4===r?n.getFloat32(0,!1):8===r?n.getFloat64(0,!1):void 0}function s(r,n){r<0&&(r=i(n));let o=t.subarray(e,e+r);return e+=r,o}function u(t,e){t<0&&(t=i(e));let r={};for(;t-- >0;){r[n()]=n()}return r}function c(t,e){t<0&&(t=i(e));let r=[];for(;t-- >0;)r.push(n());return r}function f(r,n){r<0&&(r=i(n));let o=e;return e+=r,function(t,e,r){let n=e,o="";r+=e;for(;n<r;){let e=t[n++];if(e>127)if(e>191&&e<224){if(n>=r)throw new Error("UTF-8 decode: incomplete 2-byte sequence");e=(31&e)<<6|63&t[n++]}else if(e>223&&e<240){if(n+1>=r)throw new Error("UTF-8 decode: incomplete 3-byte sequence");e=(15&e)<<12|(63&t[n++])<<6|63&t[n++]}else{if(!(e>239&&e<248))throw new Error("UTF-8 decode: unknown multibyte start 0x"+e.toString(16)+" at index "+(n-1));if(n+2>=r)throw new Error("UTF-8 decode: incomplete 4-byte sequence");e=(7&e)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++]}if(e<=65535)o+=String.fromCharCode(e);else{if(!(e<=1114111))throw new Error("UTF-8 decode: code point 0x"+e.toString(16)+" exceeds UTF-16 reach");e-=65536,o+=String.fromCharCode(e>>10|55296),o+=String.fromCharCode(1023&e|56320)}}return o}(t,o,r)}function l(t,r){t<0&&(t=i(r));let n=i(1),a=s(t);switch(n){case 255:return function(t){if(4===t.length){let e=(t[0]<<24>>>0)+(t[1]<<16>>>0)+(t[2]<<8>>>0)+t[3];return new Date(1e3*e)}if(8===t.length){let e=(t[0]<<22>>>0)+(t[1]<<14>>>0)+(t[2]<<6>>>0)+(t[3]>>>2),r=4294967296*(3&t[3])+(t[4]<<24>>>0)+(t[5]<<16>>>0)+(t[6]<<8>>>0)+t[7];return new Date(1e3*r+e/1e6)}if(12===t.length){let r=(t[0]<<24>>>0)+(t[1]<<16>>>0)+(t[2]<<8>>>0)+t[3];e-=8;let n=o(8);return new Date(1e3*n+r/1e6)}throw new Error("Invalid data length for a date value.")}(a)}return{type:n,data:a}}}let n={serialize:e,deserialize:r,encode:e,decode:r};t&&"object"==typeof t.exports?t.exports=n:window[window.msgpackJsName||"msgpack"]=n}()}).call(this,r(11)(t))},function(t,e,r){var n=function(t){"use strict";var e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(t,e,r,n){var o=e&&e.prototype instanceof f?e:f,i=Object.create(o.prototype),a=new k(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return x()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===c)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var f=u(t,e,r);if("normal"===f.type){if(n=r.done?"completed":"suspendedYield",f.arg===c)continue;return{value:f.arg,done:r.done}}"throw"===f.type&&(n="completed",r.method="throw",r.arg=f.arg)}}}(t,r,a),i}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=s;var c={};function f(){}function l(){}function h(){}var p={};p[o]=function(){return this};var d=Object.getPrototypeOf,y=d&&d(d(E([])));y&&y!==e&&r.call(y,o)&&(p=y);var g=h.prototype=f.prototype=Object.create(p);function v(t){["next","throw","return"].forEach((function(e){t[e]=function(t){return this._invoke(e,t)}}))}function b(t){var e;this._invoke=function(n,o){function i(){return new Promise((function(e,i){!function e(n,o,i,a){var s=u(t[n],t,o);if("throw"!==s.type){var c=s.arg,f=c.value;return f&&"object"==typeof f&&r.call(f,"__await")?Promise.resolve(f.__await).then((function(t){e("next",t,i,a)}),(function(t){e("throw",t,i,a)})):Promise.resolve(f).then((function(t){c.value=t,i(c)}),(function(t){return e("throw",t,i,a)}))}a(s.arg)}(n,o,e,i)}))}return e=e?e.then(i,i):i()}}function w(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return c;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var n=u(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,c;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,c):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,c)}function m(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(m,this),this.reset(!0)}function E(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:x}}function x(){return{value:void 0,done:!0}}return l.prototype=g.constructor=h,h.constructor=l,h[a]=l.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===l||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,h):(t.__proto__=h,a in t||(t[a]="GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},v(b.prototype),b.prototype[i]=function(){return this},t.AsyncIterator=b,t.async=function(e,r,n,o){var i=new b(s(e,r,n,o));return t.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},v(g),g[a]="Generator",g[o]=function(){return this},g.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=E,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),u=r.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,c):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),c},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),c}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;_(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:E(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),c}},t}(t.exports);try{regeneratorRuntime=n}catch(t){Function("r","regeneratorRuntime = r")(n)}},function(t,e,r){"use strict";(function(t){var n=r(8),o=r(9),i=r(10);function a(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(t,e){if(a()<e)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=u.prototype:(null===t&&(t=new u(e)),t.length=e),t}function u(t,e,r){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(t,e,r);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return l(this,t)}return c(this,t,e,r)}function c(t,e,r,n){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,r,n){if(e.byteLength,r<0||e.byteLength<r)throw new RangeError("'offset' is out of bounds");if(e.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");e=void 0===r&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,r):new Uint8Array(e,r,n);u.TYPED_ARRAY_SUPPORT?(t=e).__proto__=u.prototype:t=h(t,e);return t}(t,e,r,n):"string"==typeof e?function(t,e,r){"string"==typeof r&&""!==r||(r="utf8");if(!u.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|d(e,r),o=(t=s(t,n)).write(e,r);o!==n&&(t=t.slice(0,o));return t}(t,e,r):function(t,e){if(u.isBuffer(e)){var r=0|p(e.length);return 0===(t=s(t,r)).length?t:(e.copy(t,0,0,r),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(n=e.length)!=n?s(t,0):h(t,e);if("Buffer"===e.type&&i(e.data))return h(t,e.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function f(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function l(t,e){if(f(e),t=s(t,e<0?0:0|p(e)),!u.TYPED_ARRAY_SUPPORT)for(var r=0;r<e;++r)t[r]=0;return t}function h(t,e){var r=e.length<0?0:0|p(e.length);t=s(t,r);for(var n=0;n<r;n+=1)t[n]=255&e[n];return t}function p(t){if(t>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|t}function d(t,e){if(u.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return N(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return Y(t).length;default:if(n)return N(t).length;e=(""+e).toLowerCase(),n=!0}}function y(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return S(this,e,r);case"utf8":case"utf-8":return T(this,e,r);case"ascii":return A(this,e,r);case"latin1":case"binary":return R(this,e,r);case"base64":return O(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function g(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function v(t,e,r,n,o){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=o?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(o)return-1;r=t.length-1}else if(r<0){if(!o)return-1;r=0}if("string"==typeof e&&(e=u.from(e,n)),u.isBuffer(e))return 0===e.length?-1:b(t,e,r,n,o);if("number"==typeof e)return e&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):b(t,[e],r,n,o);throw new TypeError("val must be string, number or Buffer")}function b(t,e,r,n,o){var i,a=1,s=t.length,u=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;a=2,s/=2,u/=2,r/=2}function c(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}if(o){var f=-1;for(i=r;i<s;i++)if(c(t,i)===c(e,-1===f?0:i-f)){if(-1===f&&(f=i),i-f+1===u)return f*a}else-1!==f&&(i-=i-f),f=-1}else for(r+u>s&&(r=s-u),i=r;i>=0;i--){for(var l=!0,h=0;h<u;h++)if(c(t,i+h)!==c(e,h)){l=!1;break}if(l)return i}return-1}function w(t,e,r,n){r=Number(r)||0;var o=t.length-r;n?(n=Number(n))>o&&(n=o):n=o;var i=e.length;if(i%2!=0)throw new TypeError("Invalid hex string");n>i/2&&(n=i/2);for(var a=0;a<n;++a){var s=parseInt(e.substr(2*a,2),16);if(isNaN(s))return a;t[r+a]=s}return a}function m(t,e,r,n){return q(N(e,t.length-r),t,r,n)}function _(t,e,r,n){return q(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function k(t,e,r,n){return _(t,e,r,n)}function E(t,e,r,n){return q(Y(e),t,r,n)}function x(t,e,r,n){return q(function(t,e){for(var r,n,o,i=[],a=0;a<t.length&&!((e-=2)<0);++a)r=t.charCodeAt(a),n=r>>8,o=r%256,i.push(o),i.push(n);return i}(e,t.length-r),t,r,n)}function O(t,e,r){return 0===e&&r===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,r))}function T(t,e,r){r=Math.min(t.length,r);for(var n=[],o=e;o<r;){var i,a,s,u,c=t[o],f=null,l=c>239?4:c>223?3:c>191?2:1;if(o+l<=r)switch(l){case 1:c<128&&(f=c);break;case 2:128==(192&(i=t[o+1]))&&(u=(31&c)<<6|63&i)>127&&(f=u);break;case 3:i=t[o+1],a=t[o+2],128==(192&i)&&128==(192&a)&&(u=(15&c)<<12|(63&i)<<6|63&a)>2047&&(u<55296||u>57343)&&(f=u);break;case 4:i=t[o+1],a=t[o+2],s=t[o+3],128==(192&i)&&128==(192&a)&&128==(192&s)&&(u=(15&c)<<18|(63&i)<<12|(63&a)<<6|63&s)>65535&&u<1114112&&(f=u)}null===f?(f=65533,l=1):f>65535&&(f-=65536,n.push(f>>>10&1023|55296),f=56320|1023&f),n.push(f),o+=l}return function(t){var e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);var r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=4096));return r}(n)}e.Buffer=u,e.SlowBuffer=function(t){+t!=t&&(t=0);return u.alloc(+t)},e.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=a(),u.poolSize=8192,u._augment=function(t){return t.__proto__=u.prototype,t},u.from=function(t,e,r){return c(null,t,e,r)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(t,e,r){return function(t,e,r,n){return f(e),e<=0?s(t,e):void 0!==r?"string"==typeof n?s(t,e).fill(r,n):s(t,e).fill(r):s(t,e)}(null,t,e,r)},u.allocUnsafe=function(t){return l(null,t)},u.allocUnsafeSlow=function(t){return l(null,t)},u.isBuffer=function(t){return!(null==t||!t._isBuffer)},u.compare=function(t,e){if(!u.isBuffer(t)||!u.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,n=e.length,o=0,i=Math.min(r,n);o<i;++o)if(t[o]!==e[o]){r=t[o],n=e[o];break}return r<n?-1:n<r?1:0},u.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(t,e){if(!i(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return u.alloc(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var n=u.allocUnsafe(e),o=0;for(r=0;r<t.length;++r){var a=t[r];if(!u.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(n,o),o+=a.length}return n},u.byteLength=d,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)g(this,e,e+1);return this},u.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)g(this,e,e+3),g(this,e+1,e+2);return this},u.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)g(this,e,e+7),g(this,e+1,e+6),g(this,e+2,e+5),g(this,e+3,e+4);return this},u.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?T(this,0,t):y.apply(this,arguments)},u.prototype.equals=function(t){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===u.compare(this,t)},u.prototype.inspect=function(){var t="",r=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(t+=" ... ")),"<Buffer "+t+">"},u.prototype.compare=function(t,e,r,n,o){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===o&&(o=this.length),e<0||r>t.length||n<0||o>this.length)throw new RangeError("out of range index");if(n>=o&&e>=r)return 0;if(n>=o)return-1;if(e>=r)return 1;if(this===t)return 0;for(var i=(o>>>=0)-(n>>>=0),a=(r>>>=0)-(e>>>=0),s=Math.min(i,a),c=this.slice(n,o),f=t.slice(e,r),l=0;l<s;++l)if(c[l]!==f[l]){i=c[l],a=f[l];break}return i<a?-1:a<i?1:0},u.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},u.prototype.indexOf=function(t,e,r){return v(this,t,e,r,!0)},u.prototype.lastIndexOf=function(t,e,r){return v(this,t,e,r,!1)},u.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var o=this.length-e;if((void 0===r||r>o)&&(r=o),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var i=!1;;)switch(n){case"hex":return w(this,t,e,r);case"utf8":case"utf-8":return m(this,t,e,r);case"ascii":return _(this,t,e,r);case"latin1":case"binary":return k(this,t,e,r);case"base64":return E(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,t,e,r);default:if(i)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),i=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function A(t,e,r){var n="";r=Math.min(t.length,r);for(var o=e;o<r;++o)n+=String.fromCharCode(127&t[o]);return n}function R(t,e,r){var n="";r=Math.min(t.length,r);for(var o=e;o<r;++o)n+=String.fromCharCode(t[o]);return n}function S(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var o="",i=e;i<r;++i)o+=F(t[i]);return o}function P(t,e,r){for(var n=t.slice(e,r),o="",i=0;i<n.length;i+=2)o+=String.fromCharCode(n[i]+256*n[i+1]);return o}function I(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function j(t,e,r,n,o,i){if(!u.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>o||e<i)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}function C(t,e,r,n){e<0&&(e=65535+e+1);for(var o=0,i=Math.min(t.length-r,2);o<i;++o)t[r+o]=(e&255<<8*(n?o:1-o))>>>8*(n?o:1-o)}function U(t,e,r,n){e<0&&(e=4294967295+e+1);for(var o=0,i=Math.min(t.length-r,4);o<i;++o)t[r+o]=e>>>8*(n?o:3-o)&255}function B(t,e,r,n,o,i){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function D(t,e,r,n,i){return i||B(t,0,r,4),o.write(t,e,r,n,23,4),r+4}function M(t,e,r,n,i){return i||B(t,0,r,8),o.write(t,e,r,n,52,8),r+8}u.prototype.slice=function(t,e){var r,n=this.length;if((t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(e=void 0===e?n:~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t),u.TYPED_ARRAY_SUPPORT)(r=this.subarray(t,e)).__proto__=u.prototype;else{var o=e-t;r=new u(o,void 0);for(var i=0;i<o;++i)r[i]=this[i+t]}return r},u.prototype.readUIntLE=function(t,e,r){t|=0,e|=0,r||I(t,e,this.length);for(var n=this[t],o=1,i=0;++i<e&&(o*=256);)n+=this[t+i]*o;return n},u.prototype.readUIntBE=function(t,e,r){t|=0,e|=0,r||I(t,e,this.length);for(var n=this[t+--e],o=1;e>0&&(o*=256);)n+=this[t+--e]*o;return n},u.prototype.readUInt8=function(t,e){return e||I(t,1,this.length),this[t]},u.prototype.readUInt16LE=function(t,e){return e||I(t,2,this.length),this[t]|this[t+1]<<8},u.prototype.readUInt16BE=function(t,e){return e||I(t,2,this.length),this[t]<<8|this[t+1]},u.prototype.readUInt32LE=function(t,e){return e||I(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},u.prototype.readUInt32BE=function(t,e){return e||I(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},u.prototype.readIntLE=function(t,e,r){t|=0,e|=0,r||I(t,e,this.length);for(var n=this[t],o=1,i=0;++i<e&&(o*=256);)n+=this[t+i]*o;return n>=(o*=128)&&(n-=Math.pow(2,8*e)),n},u.prototype.readIntBE=function(t,e,r){t|=0,e|=0,r||I(t,e,this.length);for(var n=e,o=1,i=this[t+--n];n>0&&(o*=256);)i+=this[t+--n]*o;return i>=(o*=128)&&(i-=Math.pow(2,8*e)),i},u.prototype.readInt8=function(t,e){return e||I(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},u.prototype.readInt16LE=function(t,e){e||I(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt16BE=function(t,e){e||I(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt32LE=function(t,e){return e||I(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},u.prototype.readInt32BE=function(t,e){return e||I(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},u.prototype.readFloatLE=function(t,e){return e||I(t,4,this.length),o.read(this,t,!0,23,4)},u.prototype.readFloatBE=function(t,e){return e||I(t,4,this.length),o.read(this,t,!1,23,4)},u.prototype.readDoubleLE=function(t,e){return e||I(t,8,this.length),o.read(this,t,!0,52,8)},u.prototype.readDoubleBE=function(t,e){return e||I(t,8,this.length),o.read(this,t,!1,52,8)},u.prototype.writeUIntLE=function(t,e,r,n){(t=+t,e|=0,r|=0,n)||j(this,t,e,r,Math.pow(2,8*r)-1,0);var o=1,i=0;for(this[e]=255&t;++i<r&&(o*=256);)this[e+i]=t/o&255;return e+r},u.prototype.writeUIntBE=function(t,e,r,n){(t=+t,e|=0,r|=0,n)||j(this,t,e,r,Math.pow(2,8*r)-1,0);var o=r-1,i=1;for(this[e+o]=255&t;--o>=0&&(i*=256);)this[e+o]=t/i&255;return e+r},u.prototype.writeUInt8=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,1,255,0),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},u.prototype.writeUInt16LE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):C(this,t,e,!0),e+2},u.prototype.writeUInt16BE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):C(this,t,e,!1),e+2},u.prototype.writeUInt32LE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):U(this,t,e,!0),e+4},u.prototype.writeUInt32BE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):U(this,t,e,!1),e+4},u.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e|=0,!n){var o=Math.pow(2,8*r-1);j(this,t,e,r,o-1,-o)}var i=0,a=1,s=0;for(this[e]=255&t;++i<r&&(a*=256);)t<0&&0===s&&0!==this[e+i-1]&&(s=1),this[e+i]=(t/a>>0)-s&255;return e+r},u.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e|=0,!n){var o=Math.pow(2,8*r-1);j(this,t,e,r,o-1,-o)}var i=r-1,a=1,s=0;for(this[e+i]=255&t;--i>=0&&(a*=256);)t<0&&0===s&&0!==this[e+i+1]&&(s=1),this[e+i]=(t/a>>0)-s&255;return e+r},u.prototype.writeInt8=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,1,127,-128),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},u.prototype.writeInt16LE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):C(this,t,e,!0),e+2},u.prototype.writeInt16BE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):C(this,t,e,!1),e+2},u.prototype.writeInt32LE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):U(this,t,e,!0),e+4},u.prototype.writeInt32BE=function(t,e,r){return t=+t,e|=0,r||j(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):U(this,t,e,!1),e+4},u.prototype.writeFloatLE=function(t,e,r){return D(this,t,e,!0,r)},u.prototype.writeFloatBE=function(t,e,r){return D(this,t,e,!1,r)},u.prototype.writeDoubleLE=function(t,e,r){return M(this,t,e,!0,r)},u.prototype.writeDoubleBE=function(t,e,r){return M(this,t,e,!1,r)},u.prototype.copy=function(t,e,r,n){if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var o,i=n-r;if(this===t&&r<e&&e<n)for(o=i-1;o>=0;--o)t[o+e]=this[o+r];else if(i<1e3||!u.TYPED_ARRAY_SUPPORT)for(o=0;o<i;++o)t[o+e]=this[o+r];else Uint8Array.prototype.set.call(t,this.subarray(r,r+i),e);return i},u.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===t.length){var o=t.charCodeAt(0);o<256&&(t=o)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!u.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;var i;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(i=e;i<r;++i)this[i]=t;else{var a=u.isBuffer(t)?t:N(new u(t,n).toString()),s=a.length;for(i=0;i<r-e;++i)this[i+e]=a[i%s]}return this};var L=/[^+\/0-9A-Za-z-_]/g;function F(t){return t<16?"0"+t.toString(16):t.toString(16)}function N(t,e){var r;e=e||1/0;for(var n=t.length,o=null,i=[],a=0;a<n;++a){if((r=t.charCodeAt(a))>55295&&r<57344){if(!o){if(r>56319){(e-=3)>-1&&i.push(239,191,189);continue}if(a+1===n){(e-=3)>-1&&i.push(239,191,189);continue}o=r;continue}if(r<56320){(e-=3)>-1&&i.push(239,191,189),o=r;continue}r=65536+(o-55296<<10|r-56320)}else o&&(e-=3)>-1&&i.push(239,191,189);if(o=null,r<128){if((e-=1)<0)break;i.push(r)}else if(r<2048){if((e-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function Y(t){return n.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(L,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function q(t,e,r,n){for(var o=0;o<n&&!(o+r>=e.length||o>=t.length);++o)e[o+r]=t[o];return o}}).call(this,r(7))},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";e.byteLength=function(t){var e=c(t),r=e[0],n=e[1];return 3*(r+n)/4-n},e.toByteArray=function(t){var e,r,n=c(t),a=n[0],s=n[1],u=new i(function(t,e,r){return 3*(e+r)/4-r}(0,a,s)),f=0,l=s>0?a-4:a;for(r=0;r<l;r+=4)e=o[t.charCodeAt(r)]<<18|o[t.charCodeAt(r+1)]<<12|o[t.charCodeAt(r+2)]<<6|o[t.charCodeAt(r+3)],u[f++]=e>>16&255,u[f++]=e>>8&255,u[f++]=255&e;2===s&&(e=o[t.charCodeAt(r)]<<2|o[t.charCodeAt(r+1)]>>4,u[f++]=255&e);1===s&&(e=o[t.charCodeAt(r)]<<10|o[t.charCodeAt(r+1)]<<4|o[t.charCodeAt(r+2)]>>2,u[f++]=e>>8&255,u[f++]=255&e);return u},e.fromByteArray=function(t){for(var e,r=t.length,o=r%3,i=[],a=0,s=r-o;a<s;a+=16383)i.push(f(t,a,a+16383>s?s:a+16383));1===o?(e=t[r-1],i.push(n[e>>2]+n[e<<4&63]+"==")):2===o&&(e=(t[r-2]<<8)+t[r-1],i.push(n[e>>10]+n[e>>4&63]+n[e<<2&63]+"="));return i.join("")};for(var n=[],o=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,u=a.length;s<u;++s)n[s]=a[s],o[a.charCodeAt(s)]=s;function c(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function f(t,e,r){for(var o,i,a=[],s=e;s<r;s+=3)o=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(255&t[s+2]),a.push(n[(i=o)>>18&63]+n[i>>12&63]+n[i>>6&63]+n[63&i]);return a.join("")}o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63},function(t,e){e.read=function(t,e,r,n,o){var i,a,s=8*o-n-1,u=(1<<s)-1,c=u>>1,f=-7,l=r?o-1:0,h=r?-1:1,p=t[e+l];for(l+=h,i=p&(1<<-f)-1,p>>=-f,f+=s;f>0;i=256*i+t[e+l],l+=h,f-=8);for(a=i&(1<<-f)-1,i>>=-f,f+=n;f>0;a=256*a+t[e+l],l+=h,f-=8);if(0===i)i=1-c;else{if(i===u)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,n),i-=c}return(p?-1:1)*a*Math.pow(2,i-n)},e.write=function(t,e,r,n,o,i){var a,s,u,c=8*i-o-1,f=(1<<c)-1,l=f>>1,h=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:i-1,d=n?1:-1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=f):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),(e+=a+l>=1?h/u:h*Math.pow(2,1-l))*u>=2&&(a++,u/=2),a+l>=f?(s=0,a=f):a+l>=1?(s=(e*u-1)*Math.pow(2,o),a+=l):(s=e*Math.pow(2,l-1)*Math.pow(2,o),a=0));o>=8;t[r+p]=255&s,p+=d,s/=256,o-=8);for(a=a<<o|s,c+=o;c>0;t[r+p]=255&a,p+=d,a/=256,c-=8);t[r+p-d]|=128*y}},function(t,e){var r={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)}},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(e,r){e.exports=t},function(t,e,r){"use strict";r.r(e);r(5);var n=r(0),o=r(3),i=r.n(o),a="/realtime";function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&d(t,e)}function l(t){var e="function"==typeof Map?new Map:void 0;return(l=function(t){if(null===t||(r=t,-1===Function.toString.call(r).indexOf("[native code]")))return t;var r;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return p(t,arguments,y(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),d(n,t)})(t)}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function p(t,e,r){return(p=h()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var o=new(Function.bind.apply(t,n));return r&&d(o,r.prototype),o}).apply(null,arguments)}function d(t,e){return(d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function y(t){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var g=function(t){function e(){return u(this,e),c(this,y(e).call(this,"Not implemented"))}return f(e,t),e}(l(Error)),v=function(t){function e(t){return u(this,e),c(this,y(e).call(this,"Invalid argument ".concat(t)))}return f(e,t),e}(l(Error));function b(t,e,r,n,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,o)}function w(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){b(i,n,o,a,s,"next",t)}function s(t){b(i,n,o,a,s,"throw",t)}a(void 0)}))}}function m(t,e){return _.apply(this,arguments)}function _(){return(_=w(regeneratorRuntime.mark((function t(e,r){var n,o,a,s,u,c,f,l,h=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n=h.length>2&&void 0!==h[2]?h[2]:"https://auth.noccela.com")&&n.startsWith("http")){t.next=3;break}throw new v("domain");case 3:if(e&&"number"==typeof e){t.next=5;break}throw new v("clientId");case 5:if(r&&"string"==typeof r){t.next=7;break}throw new v("clientSecret");case 7:return o=new URL("/connect/token",n).href,(a=new URLSearchParams).append("client_id","".concat(e)),a.append("client_secret",r),a.append("grant_type","client_credentials"),t.next=14,i()(o,{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a});case 14:return s=t.sent,t.next=17,s.json();case 17:if(u=t.sent,c=u.expires_in,f=u.access_token,!(l=u.error)){t.next=23;break}throw Error("Authentication failed: ".concat(l));case 23:return t.abrupt("return",{tokenExpiration:c,accessToken:f});case 24:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var k=r(1);function E(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function x(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function O(t,e,r){return e&&x(t.prototype,e),r&&x(t,r),t}var T=function(){function t(e,r,n,o,i){E(this,t),this._eventType=e,this._responseType=r,this._callback=n,this._args=o,this._unregisterRequest=i,this._failedAttempts=0}return O(t,[{key:"failedAttempts",get:function(){return this._failedAttempts},set:function(t){this._failedAttempts=t}},{key:"eventType",get:function(){return this._eventType}},{key:"responseType",get:function(){return this._responseType}},{key:"callback",get:function(){return this._callback}},{key:"args",get:function(){return this._args}},{key:"unregisterRequest",get:function(){return this._unregisterRequest}}]),t}(),A=function(){function t(e,r,n){if(E(this,t),"function"!=typeof e)throw new v("resolve");if("function"!=typeof r)throw new v("reject");if(!Number.isInteger(n))throw new v("timeout");this.sentAt=Date.now(),this.timeout=n,this._resolve=e,this._reject=r}return O(t,[{key:"resolve",value:function(t){this._resolve(t)}},{key:"reject",value:function(t){this._reject(t)}},{key:"hasTimedOut",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=(t||Date.now())-this.sentAt;if(e<=0||!Number.isInteger(e))throw Error("Invalid tof ".concat(e));return e>this.timeout}}]),t}(),R=function(){function t(e){E(this,t),this._logger=null,this._logger=e.logger}return O(t,[{key:"logger",get:function(){return this._logger}}]),t}();function S(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function P(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?S(Object(r),!0).forEach((function(e){I(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):S(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function I(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function j(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){o=!0,i=t}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function C(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var U=function(){function t(e,r,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var i=e.readyState;if(!Number.isInteger(i)||1!=i)throw new v("socket");this._requestHandlers={},this._serverMessageHandlers={},this._timeoutCheckTimeout=null,this._onCloseCallback=null,this._reconnectCallback=n,this._defaultTimeout=r.requestTimeout,this._timeoutCheckInterval=Math.max(this._defaultTimeout/2||0,5e3),this._options=r,this._logger=null,this._logger=o.logger,this._dependencyContainer=o,this._socket=e,this._bindSocketCallbacks(),this._checkTimeouts=this._checkTimeouts.bind(this),this._defaultTimeout&&(this._timeoutCheckTimeout=setTimeout(this._checkTimeouts,this._timeoutCheckInterval))}var e,r,o;return e=t,(r=[{key:"_bindSocketCallbacks",value:function(){this._socket.onclose=this._onClose.bind(this),this._socket.onerror=this._onError.bind(this),this._socket.onmessage=this._onMessage.bind(this)}},{key:"_onError",value:function(t){var e=t.message;this._logger.error("Socket error: ".concat(e))}},{key:"_onClose",value:function(t){var e=t.code,r=t.reason;this._logger.log("Socket closed with code ".concat(e,", ").concat(r?" ".concat(r):"")),this._socket.onmessage=null,this._rejectAllWaitingHandlers("socket closed"),this._requestHandlers={},this._serverMessageHandlers={},clearTimeout(this._timeoutCheckTimeout),this._onCloseCallback&&this._onCloseCallback(),this._options.reopenBrokenConnection&&this._reconnectCallback&&!this._onCloseCallback&&this._reconnectCallback(),this._onCloseCallback=null}},{key:"_onMessage",value:function(t){var e,r,o,i,a=this,s=t.data;if(s===n.e.PING_MSG)return this._logger.debug("<- PING"),void this._socket.send(n.e.PONG_MSG);try{var u=JSON.parse(s);e=u.uniqueId,r=u.action,o=u.status,i=u.payload}catch(t){return void this._logger.exception("Failed to parse message",t)}var c=o===n.e.CLOUD_RESPONSE_OK,f=!1;"getInitialTagState"!==e||c?"getInitialTagState"===e&&c?f=!0:"initialTagState"===r&&c&&(e=r,r=null):r="initialTagState";var l=this._requestHandlers[e],h=this._serverMessageHandlers[r];if(!f)if(l)c?setTimeout((function(){try{l.resolve(i)}catch(t){a._logger.exception("Exception thrown inside request resolve callback",t)}}),0):setTimeout((function(){try{l.reject(o)}catch(t){a._logger.exception("Exception thrown inside request reject callback",t)}}),0),delete this._requestHandlers[e];else if(h){var p=!0,d=!1,y=void 0;try{for(var g,v=function(){var t=g.value;setTimeout((function(){try{t.callback(i)}catch(t){a._logger.exception("Exception while processing server message",t)}}),0)},b=h[Symbol.iterator]();!(p=(g=b.next()).done);p=!0)v()}catch(t){d=!0,y=t}finally{try{p||null==b.return||b.return()}finally{if(d)throw y}}}else this._logger.warn("Got message with no handler: uniqueId/action ".concat(e||r,", status: ").concat(o));this._options.logRawMessages&&this._logger.debug("<- ".concat(o," "),s.substr(0,150))}},{key:"_checkTimeouts",value:function(){for(var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r=[],n=function(){var e=j(i[o],2),n=e[0],a=e[1];a.hasTimedOut(Date.now())&&(setTimeout((function(){try{a.reject("timeout")}catch(e){t._logger.exception("Error while rejecting timed out handler",e)}}),0),r.push(n))},o=0,i=Object.entries(this._requestHandlers);o<i.length;o++)n();for(var a=0,s=r;a<s.length;a++){var u=s[a];delete this._requestHandlers[u]}e&&(this._timeoutCheckTimeout=setTimeout(this._checkTimeouts,this._timeoutCheckInterval))}},{key:"_rejectAllWaitingHandlers",value:function(t){for(var e=this,r=function(){var r=j(o[n],2)[1];setTimeout((function(){try{r.reject(t)}catch(t){e._logger.exception("Error while rejecting handler",t)}}),0)},n=0,o=Object.entries(this._requestHandlers);n<o.length;n++)r()}},{key:"sendRequest",value:function(t,e){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new Promise((function(i,a){var s=P({},e,{uniqueId:t}),u=new A(i,a,n||r._defaultTimeout);r._requestHandlers[o||t]=u,r._socket.send(JSON.stringify(s)),r._logger.debug("Sent request with uuid ".concat(t))}))}},{key:"registerServerCallback",value:function(t,e,r){if(!t)throw Error("Invalid action '".concat(t,"'"));if(!e)throw Error("Invalid uuid '".concat(e,"'"));var n={callback:r,uuid:e};Object.prototype.hasOwnProperty.call(this._serverMessageHandlers,t)||(this._serverMessageHandlers[t]=[]),this._serverMessageHandlers[t].push(n)}},{key:"removeServerCallback",value:function(t,e){var r=this._serverMessageHandlers[t];r&&(this._serverMessageHandlers[t]=r.filter((function(t){return t.uuid!==e})),this._serverMessageHandlers[t].length||delete this._serverMessageHandlers[t])}},{key:"setClosureCallback",value:function(t){this._onCloseCallback=t}}])&&C(e.prototype,r),o&&C(e,o),t}();function B(t){return new Promise((function(e,r){t.onopen=function(){t.onopen=null,t.onclose=null,e()},t.onerror=function(e){t.onopen=null,t.onclose=null,t.onerror=null,r("Error while connecting: '".concat(e.message,"'"))},t.onclose=function(e){t.onopen=null,t.onclose=null,t.onerror=null;var n=e.code,o=e.reason;r("Failed to connect, code ".concat(n).concat(o?", reason ".concat(o):""))}}))}function D(t,e){return new Promise((function(r,n){t.onmessage=function(e){t.onmessage=null,t.onclose=null;var o,i=e.data;try{o=JSON.parse(i)}catch(t){return void n("Failed to parse first message from cloud: ".concat(t))}var a=o,s=a.uniqueId,u=a.payload,c=u.tokenExpiration,f=u.tokenIssued;"authSuccess"===s?r({tokenExpiration:+c,tokenIssued:+f}):n("Got uknown initial message ".concat(i," after authentication"))},t.onclose=function(e){var r=e.code,o=e.reason;t.onmessage=null,t.onclose=null,n("Invalid token? Closure code ".concat(r).concat(o?", ".concat(o):""))},t.send(e)}))}var M=r(2);function L(t){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function F(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function N(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?F(Object(r),!0).forEach((function(e){Y(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):F(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Y(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function q(t,e){return!e||"object"!==L(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function H(t,e,r){return(H="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=G(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function G(t){return(G=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function J(t,e){return(J=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function z(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){o=!0,i=t}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function W(t,e,r,n,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,o)}function V(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){W(i,n,o,a,s,"next",t)}function s(t){W(i,n,o,a,s,"throw",t)}a(void 0)}))}}function X(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function K(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Z(t,e,r){return e&&K(t.prototype,e),r&&K(t,r),t}var $=function(t){function e(){return X(this,e),q(this,G(e).apply(this,arguments))}var r,o,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&J(t,e)}(e,t),Z(e,[{key:"_refreshToken",value:(i=V(regeneratorRuntime.mark((function t(e,r,o){var i,a,s,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._logger.log("Refreshing access token..."),null!==this._socketHandler){t.next=3;break}throw Error(n.c);case 3:return t.next=5,m(e,r,o);case 5:return i=t.sent,a=i.accessToken,this._logger.debug("Got new token, sending to cloud"),s=Object(k.a)(),t.next=11,this._socketHandler.sendRequest(s,{action:"refreshToken",payload:{token:a}});case 11:return u=t.sent,this._logger.log("Token refreshed successfully, new expiration ".concat(u.tokenExpiration)),this._lastJwtUsed=a,t.abrupt("return",u);case 15:case"end":return t.stop()}}),t,this)}))),function(t,e,r){return i.apply(this,arguments)})},{key:"scheduleTokenRefresh",value:function(t){var e=this,r=t.authServerDomain,n=t.tokenExpiration,o=t.tokenIssued,i=t.clientId,a=t.clientSecret,s=n-o;if("number"!=typeof s||s<=0)throw Error("Received invalid token information");var u=Math.trunc(o+s/2),c=Math.trunc(Date.now()/1e3),f=0|Math.max(1e3*(u-c),1e3);clearTimeout(this._tokenExpirationTimeout);var l=function(){var n=V(regeneratorRuntime.mark((function n(){var o,s,u;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e._refreshToken(r,i,a);case 3:o=n.sent,s=o.tokenExpiration,u=o.tokenIssued,e.scheduleTokenRefresh(N({},t,{tokenExpiration:+s,tokenIssued:+u})),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(0),e._logger.exception("Error while fetching new token, trying again later",n.t0),setTimeout(l,e._options.tokenRefreshFailureRetryTimeout);case 13:case"end":return n.stop()}}),n,null,[[0,9]])})));return function(){return n.apply(this,arguments)}}();this._logger.debug("Refreshing the token at ".concat(new Date(1e3*u))),this._tokenExpirationTimeout=setTimeout(l,f)}},{key:"createAuthenticatedConnection",value:(o=V(regeneratorRuntime.mark((function t(e,r,n){var o,i,a,s,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m(r,n,e);case 2:return o=t.sent,i=o.accessToken,t.next=6,this.connect(i);case 6:a=t.sent,s=a.tokenExpiration,u=a.tokenIssued,this._options.automaticTokenRenewal&&this.scheduleTokenRefresh({authServerDomain:e,tokenExpiration:s,tokenIssued:u,clientId:r,clientSecret:n});case 10:case"end":return t.stop()}}),t,this)}))),function(t,e,r){return o.apply(this,arguments)})},{key:"close",value:(r=V(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return clearTimeout(this._tokenExpirationTimeout),t.next=3,H(G(e.prototype),"close",this).call(this);case 3:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})}]),e}(function(){function t(e,r,n){if(X(this,t),!e||"string"!=typeof e)throw Error("Invalid address");if(!e.startsWith("ws"))throw Error("Invalid protocol for WS address, expected ws or wss");this._address=e,this._options=r,this._socket=null,this._socketHandler=null,this._lastJwtUsed=null,this._tokenExpirationTimeout=null,this._retryTimeout=null,this._nextRetryInterval=null,this._logger=null,this._logger=n.logger,this._dependencyContainer=n,this._reconnect=this._reconnect.bind(this)}var e,r,o,i;return Z(t,[{key:"_reconnect",value:function(){function t(){return(t=V(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.connect(this._lastJwtUsed);case 3:this._onConnectionRecreated&&this._onConnectionRecreated(),t.next=11;break;case 6:return t.prev=6,t.t0=t.catch(0),this._logger.exception("Exception while attempting to reconnect",t.t0),this._reconnect(),t.abrupt("return");case 11:this._logger.log("Connection re-established");case 12:case"end":return t.stop()}}),t,this,[[0,6]])})))).apply(this,arguments)}this._socketHandler=null;var e=z(function(t,e,r,n,o){clearTimeout(t);var i=e||r.retryIntervalMin,a=Math.min(i+r.retryIntervalIncrease,r.retryIntervalMax);return o.log("Trying to reconnect in ".concat(i," ms")),[setTimeout(n,i),a]}(this._retryTimeout,this._nextRetryInterval,this._options,function(){return t.apply(this,arguments)}.bind(this),this._logger),2);this._retryTimeout=e[0],this._nextRetryInterval=e[1]}},{key:"sendMessageRaw",value:(i=V(regeneratorRuntime.mark((function t(e,r,o,i){var a,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!==this._socketHandler){t.next=2;break}throw Error(n.c);case 2:return Object(k.c)(r,o),a=Object(k.a)(),s={accountId:r,siteId:o,payload:i,action:e},t.next=7,this._socketHandler.sendRequest(a,s);case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}}),t,this)}))),function(t,e,r,n){return i.apply(this,arguments)})},{key:"setOnReconnectCallback",value:function(t){if(t&&"function"!=typeof t)throw new v("onConnectionRecreated");this._onConnectionRecreated=t}},{key:"close",value:(o=V(regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.connected){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,new Promise((function(t,r){e._socketHandler.setClosureCallback((function(){t(),e._socketHandler=null,e._lastJwtUsed=null})),clearTimeout(e._retryTimeout);try{e._socket.close()}catch(t){r(t)}}));case 4:case"end":return t.stop()}}),t,this)}))),function(){return o.apply(this,arguments)})},{key:"connect",value:(r=V(regeneratorRuntime.mark((function t(e){var r,n,o,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&"string"==typeof e){t.next=2;break}throw Error("Invalid JWT");case 2:if(!this._socket||!this.connected){t.next=4;break}return t.abrupt("return");case 4:return clearTimeout(this._retryTimeout),t.next=7,Object(M.b)();case 7:return r=t.sent,this._webSocketStateOpen=r.OPEN,this._webSocketStateClosed=r.CLOSED,this._socket=new r(this._address),this._logger.log("Connecting to ".concat(this._address)),t.next=14,B(this._socket);case 14:return this._logger.log("Connected, sending token"),t.next=17,D(this._socket,e);case 17:return n=t.sent,o=n.tokenExpiration,i=n.tokenIssued,this._logger.log("Authentication successful, token expiration ".concat(o)),this._socketHandler=new U(this._socket,this._options,this._reconnect,this._dependencyContainer),this._lastJwtUsed=e,this._nextRetryInterval=this._options.retryIntervalMin,t.abrupt("return",{tokenExpiration:o,tokenIssued:i});case 25:case"end":return t.stop()}}),t,this)}))),function(t){return r.apply(this,arguments)})},{key:"registerServerCallback",value:function(t,e,r){this._socketHandler.registerServerCallback(t,e,r)}},{key:"unregisterServerCallback",value:function(t,e){this._socketHandler.removeServerCallback(t,e)}},{key:"sendRequest",value:(e=V(regeneratorRuntime.mark((function t(e,r){var n,o,i=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=i.length>2&&void 0!==i[2]?i[2]:null,o=i.length>3&&void 0!==i[3]?i[3]:null,"string"==typeof e){t.next=4;break}throw new v("uuid");case 4:return t.next=6,this._socketHandler.sendRequest(e,r,n,o);case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t,this)}))),function(t,r){return e.apply(this,arguments)})},{key:"connected",get:function(){return!!this._socket&&!!this._socketHandler&&this._socket.readyState===this._webSocketStateOpen}}]),t}()),Q=r(4),tt=r.n(Q);function et(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){o=!0,i=t}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var rt=Object(M.a)();function nt(t){var e=function(t){for(var e=rt(t),r=new ArrayBuffer(e.length),n=new Uint8Array(r),o=0;o<e.length;o++)n[o]=e.charCodeAt(o);return tt.a.deserialize(n)}(t),r={},n=Object.keys(e);if(!n||!n.length)return{};for(var o=0,i=Object.entries(e);o<i.length;o++){var a=et(i[o],2),s=a[0],u=a[1],c={deviceId:+s};c.name=u[1],c.batteryVoltage=u[2],c.batteryStatus=u[3],c.status=u[4],c.areas=u[5],c.wire=u[6],c.reed=u[7],c.isOnline=u[8],c.timestamp=u[9],c.x=u[10],c.y=u[11],c.accelerometer=u[12],c.floorId=u[13],c.signalLost=u[14],c.powerSave=u[15],r[c.deviceId]=c}return r}function ot(t){return(ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function it(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function at(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?it(Object(r),!0).forEach((function(e){st(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):it(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function st(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ut(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){o=!0,i=t}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function ct(t,e){return!e||"object"!==ot(e)&&"function"!=typeof e?lt(t):e}function ft(t){return(ft=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function lt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ht(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&pt(t,e)}function pt(t,e){return(pt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function dt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function yt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function gt(t,e,r){return e&&yt(t.prototype,e),r&&yt(t,r),t}function vt(t,e,r,n){if(!t||"function"!=typeof t)throw new v("filterClass");if(!e||"function"!=typeof e)throw new v("callback");var o=new t(r);return new bt(e,o,n)}var bt=function(){function t(e,r,n){if(dt(this,t),!e||"function"!=typeof e)throw new v("callback");if(!(r&&r instanceof wt))throw new v("filter");this.callback=e,this.filterObj=r,this._logger=null,this._logger=n.logger}return gt(t,[{key:"process",value:function(t){var e=this;if(t){var r;try{r=this.filterObj.filter(t)}catch(t){return void this._logger.exception("Exception while filtering message",t)}if(r){var n=r.constructor;r&&(n!=Array||r.length)&&(n!=Object||Object.keys(r).length)&&setTimeout((function(){try{e.callback(null,r)}catch(t){e._logger.exception("Error in location update callback",t)}}),0)}}}}]),t}(),wt=function(){function t(){dt(this,t)}return gt(t,[{key:"filter",value:function(t){throw new g}}]),t}(),mt=function(t){function e(t){var r;return dt(this,e),(r=ct(this,ft(e).call(this)))._account=null,r._site=null,r._deviceIds=null,r._account=t.account,r._site=t.site,r._deviceIds=t.deviceIds,r._deviceIds&&(r._deviceIds=new Set(r._deviceIds)),r.filter=r.filter.bind(lt(r)),r}return ht(e,t),gt(e,[{key:"filter",value:function(t){var e=this,r=t.accountId,n=t.siteId,o=t.tags;return+r!==this._account?null:+n!==this._site?null:o?this._deviceIds?Object.entries(o).reduce((function(t,r){var n=ut(r,2),o=n[0],i=n[1];return e._deviceIds.has(+o)?at({},t,st({},o,i)):t}),{}):o:null}}]),e}(wt),_t=function(t){function e(t){var r;return dt(this,e),(r=ct(this,ft(e).call(this)))._account=null,r._site=null,r._deviceIds=null,r._account=t.account,r._site=t.site,r._deviceIds=t.deviceIds,r._deviceIds&&(r._deviceIds=new Set(r._deviceIds)),r.filter=r.filter.bind(lt(r)),r}return ht(e,t),gt(e,[{key:"filter",value:function(t){var e=this,r=t.accountId,n=t.siteId,o=t.tags,i=t.removedTags;if(+r!==this._account)return null;if(+n!==this._site)return null;if(!o&&!i)return null;if(!this._deviceIds)return{tags:o,removedTags:i};var a=Object.entries(o).reduce((function(t,r){var n=ut(r,2),o=n[0],i=n[1];return e._deviceIds.has(+o)?at({},t,st({},o,i)):t}),{}),s=null;return i&&(s=Object.entries(i).filter((function(t){return e._deviceIds.has(t)}))),Object.keys(a).length||s&&s.length?{tags:a,removedTags:s}:null}}]),e}(wt),kt=function(t){function e(t){var r;return dt(this,e),(r=ct(this,ft(e).call(this)))._account=null,r._site=null,r._deviceIds=null,r._account=t.account,r._site=t.site,r._deviceIds=t.deviceIds,r._deviceIds&&(r._deviceIds=new Set(r._deviceIds)),r.filter=r.filter.bind(lt(r)),r}return ht(e,t),gt(e,[{key:"filter",value:function(t){var e=this,r=t.accountId,n=t.siteId,o=t.data;if(+r!==this._account)return null;if(+n!==this._site)return null;if(!o)return null;var i=nt(o);return this._deviceIds?Object.entries(i).reduce((function(t,r){var n=ut(r,2),o=n[0],i=n[1];return e._deviceIds.has(+o)?at({},t,st({},o,i)):t}),{}):i}}]),e}(wt);function Et(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){o=!0,i=t}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function xt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Ot(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?xt(Object(r),!0).forEach((function(e){Tt(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):xt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Tt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function At(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Rt(t,e,r,n,o,i,a){try{var s=t[i](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,o)}function St(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Rt(i,n,o,a,s,"next",t)}function s(t){Rt(i,n,o,a,s,"throw",t)}a(void 0)}))}}function Pt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function It(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var jt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"wss://api.noccela.com";Pt(this,t);var o=new URL(a,r).href,i=Object.assign(n.a,e);this._options=i;var s={log:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return i.loggers.forEach((function(t){return t&&t.log.apply(t,e)}))},warn:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return i.loggers.forEach((function(t){return t&&t.warn.apply(t,e)}))},error:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return i.loggers.forEach((function(t){return t&&t.error.apply(t,e)}))},exception:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return i.loggers.forEach((function(t){return t&&t.exception.apply(t,e)}))},debug:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return i.loggers.forEach((function(t){return t&&t.debug.apply(t,e)}))}};this._logger=s,this._registeredEvents={},this._dependencyContainer=new R({logger:s}),this._connection=new $(o,this._options,this._dependencyContainer),this._connection.setOnReconnectCallback(this._reregisterEvents.bind(this))}var e,r,o,i,s,u,c,f,l,h,p,d,y,g;return e=t,(r=[{key:"_reregisterEvents",value:(g=St(regeneratorRuntime.mark((function t(){var e,r,n,o,i,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=Object.values(this._registeredEvents),this._registeredEvents={},r=0,n=e;case 3:if(!(r<n.length)){t.next=26;break}return o=n[r],i=o.eventType,a=o.args,t.prev=6,t.next=9,this.register.apply(this,At(a));case 9:t.next=23;break;case 11:if(t.prev=11,t.t0=t.catch(6),this._logger.exception("Error while re-registering event ".concat(i),t.t0),o.failedAttempts++,this._options.registrationAttemptsUntilIgnored&&!(o.failedAttempts<=this._options.registrationAttemptsUntilIgnored)){t.next=22;break}return t.next=19,Object(k.e)(this._options.waitForFailedReRegistration);case 19:e.push(o),t.next=23;break;case 22:this._logger.error("Failed to re-register ".concat(i," ").concat(o.failedAttempts," times, giving up"));case 23:r++,t.next=3;break;case 26:case"end":return t.stop()}}),t,this,[[6,11]])}))),function(){return g.apply(this,arguments)})},{key:"connect",value:(y=St(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._connection.connect(e);case 2:case"end":return t.stop()}}),t,this)}))),function(t){return y.apply(this,arguments)})},{key:"connectPersistent",value:(d=St(regeneratorRuntime.mark((function t(e,r){var n,o=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=o.length>2&&void 0!==o[2]?o[2]:"https://auth.noccela.com",t.abrupt("return",this._connection.createAuthenticatedConnection(n,e,r));case 2:case"end":return t.stop()}}),t,this)}))),function(t,e){return d.apply(this,arguments)})},{key:"close",value:(p=St(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._connection.close();case 2:this._registeredEvents={};case 3:case"end":return t.stop()}}),t,this)}))),function(){return p.apply(this,arguments)})},{key:"registerLocationUpdate",value:(h=St(regeneratorRuntime.mark((function t(e,r,o){var i,a=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=a.length>3&&void 0!==a[3]?a[3]:null,t.abrupt("return",this.register(n.b.LOCATION_UPDATE,r,o,{deviceIds:i},e));case 2:case"end":return t.stop()}}),t,this)}))),function(t,e,r){return h.apply(this,arguments)})},{key:"registerInitialTagState",value:(l=St(regeneratorRuntime.mark((function t(e,r,o){var i,a=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=a.length>3&&void 0!==a[3]?a[3]:null,t.abrupt("return",this.register(n.b.TAG_STATE,r,o,{deviceIds:i},e));case 2:case"end":return t.stop()}}),t,this)}))),function(t,e,r){return l.apply(this,arguments)})},{key:"registerTagDiffStream",value:(f=St(regeneratorRuntime.mark((function t(e,r,o){var i,a=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=a.length>3&&void 0!==a[3]?a[3]:null,t.abrupt("return",this.register(n.b.TAG_DIFF,r,o,{deviceIds:i},e));case 2:case"end":return t.stop()}}),t,this)}))),function(t,e,r){return f.apply(this,arguments)})},{key:"register",value:(c=St(regeneratorRuntime.mark((function t(e,r,o,i,a){var s,u,c,f,l,h,p,d,y,g,v,b,w=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:s=w.length>5&&void 0!==w[5]?w[5]:null,this._validateConnection(),Object(k.c)(r,o),u=s||Object(k.a)(),c=null,f=null,l=Ot({},i=i||{},{account:r,site:o}),t.t0=e,t.next=t.t0===n.b.LOCATION_UPDATE?11:t.t0===n.b.TAG_DIFF?20:t.t0===n.b.TAG_STATE?29:37;break;case 11:return Object(k.d)(i,["deviceIds"],null),c="locationUpdate",h=vt(mt,a,l,this._dependencyContainer),this._connection.registerServerCallback(c,u,h.process.bind(h)),p={accountId:r,siteId:o,action:"registerTagLocation",payload:i},t.next=18,this._connection.sendRequest(u,p);case 18:return f=Ot({},p,{action:"unregisterTagLocation"}),t.abrupt("break",38);case 20:return Object(k.d)(i,["deviceIds"],null),c="tagDiffStream",d=vt(_t,a,l,this._dependencyContainer),this._connection.registerServerCallback(c,u,d.process.bind(d)),y={accountId:r,siteId:o,action:"registerTagDiffStream",payload:i},t.next=27,this._connection.sendRequest(u,y);case 27:return f=Ot({},y,{action:"unregisterTagDiffStream"}),t.abrupt("break",38);case 29:return Object(k.d)(i,["deviceIds"],null),c="initialTagState",t.next=33,this.getTagState(r,o,i.deviceIds);case 33:return g=t.sent,c="initialTagState",a(null,g),t.abrupt("break",38);case 37:throw Error("Invalid event type ".concat(e,", available types ").concat(Object.keys(n.b).join()));case 38:return this._logger.log("Registered event ".concat(e," with uuid ").concat(u)),v=JSON.stringify(i),(b=Object.entries(this._registeredEvents).filter((function(t){var r=Et(t,2)[1];return r.eventType===e&&JSON.stringify(r.args[3])===v})).map((function(t){return Et(t,1)[0]})))&&b.length&&this._logger.warn("Multiple events with identical types and filters added! Currently if one of these is unregistered they are all "+"unregisted! Events: ".concat(JSON.stringify(b))),this._registeredEvents[u]=new T(e,c,a,[e,r,o,i,a,u],f),t.abrupt("return",u);case 44:case"end":return t.stop()}}),t,this)}))),function(t,e,r,n,o){return c.apply(this,arguments)})},{key:"getTagState",value:(u=St(regeneratorRuntime.mark((function t(e,r){var n,o,i,a=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=a.length>2&&void 0!==a[2]?a[2]:null,this._validateConnection(),Object(k.c)(e,r),t.next=5,this._connection.sendRequest("getInitialTagState",{accountId:e,siteId:r,action:"initialTagState",payload:{deviceIds:n}},null,"initialTagState");case 5:return o=t.sent,i=new kt({account:e,site:r,deviceIds:n}),t.abrupt("return",i.filter(o));case 8:case"end":return t.stop()}}),t,this)}))),function(t,e){return u.apply(this,arguments)})},{key:"unregister",value:(s=St(regeneratorRuntime.mark((function t(e){var r,n,o,i,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this._registeredEvents[e]){t.next=3;break}return t.abrupt("return",!1);case 3:if(n=r.eventType,o=r.responseType,!(i=r.unregisterRequest)){t.next=12;break}if(!this._connection){t.next=12;break}if(a=Object(k.a)(),!this._connection.connected){t.next=12;break}return t.next=12,this._connection.sendRequest(a,i);case 12:return delete this._registeredEvents[e],this._connection&&this._connection.unregisterServerCallback(o,e),this._logger.log("Unregistered event ".concat(n," with UUID ").concat(e)),t.abrupt("return",!0);case 16:case"end":return t.stop()}}),t,this)}))),function(t){return s.apply(this,arguments)})},{key:"sendMessageRaw",value:(i=St(regeneratorRuntime.mark((function t(e,r,n,o){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._connection.sendMessageRaw(e,r,n,o);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)}))),function(t,e,r,n){return i.apply(this,arguments)})},{key:"registerToServerMessageRaw",value:function(t,e){var r=Object(k.a)();return this._connection.registerServerCallback(t,r,(function(t){return e(null,t)})),r}},{key:"unregisterServerMessageRaw",value:function(t,e){this._connection.unregisterServerCallback(t,e)}},{key:"_validateConnection",value:function(){if(!this._connection.connected)throw Error("Authenticated connection does not exists")}}])&&It(e.prototype,r),o&&It(e,o),t}();r.d(e,"EVENT_TYPES",(function(){return n.b})),r.d(e,"DEFAULT_OPTIONS",(function(){return n.a})),r.d(e,"getToken",(function(){return m})),r.d(e,"EventChannel",(function(){return jt}))}])}));